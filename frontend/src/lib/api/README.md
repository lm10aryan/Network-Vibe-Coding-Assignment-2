# User API Documentation

This document describes the User API implementation for the LVL.AI frontend, which provides comprehensive user management functionality based on the backend routes.

## ğŸ“ File Structure

```
src/lib/api/
â”œâ”€â”€ client.ts          # Main API client with interceptors
â”œâ”€â”€ users.ts           # User API class with all user operations
â”œâ”€â”€ index.ts           # Exports all API modules
â””â”€â”€ ...

src/hooks/
â””â”€â”€ useUserAPI.ts      # React hooks for user operations

src/components/user/
â””â”€â”€ UserProfile.tsx    # Example component using the User API
```

## ğŸš€ Quick Start

### Basic Usage

```typescript
import { UserAPI } from '@/lib/api/users';

// Get current user profile
const profile = await UserAPI.getMyProfile();

// Get user tasks
const tasks = await UserAPI.getUserTasks(userId, {
  category: 'Productivity',
  completed: false,
  page: 1,
  limit: 10
});

// Add a new task
const newTask = await UserAPI.addUserTask(userId, {
  title: 'Complete project',
  category: 'Productivity',
  xpValue: 50
});
```

### Using React Hooks

```typescript
import { useCurrentUserAPI } from '@/hooks/useUserAPI';

function MyComponent() {
  const userAPI = useCurrentUserAPI();

  const handleAddTask = async () => {
    try {
      const task = await userAPI.addTaskToMe({
        title: 'New Task',
        category: 'Productivity',
        xpValue: 10
      });
      console.log('Task created:', task);
    } catch (error) {
      console.error('Failed to create task:', error);
    }
  };

  return (
    <button onClick={handleAddTask}>
      Add Task
    </button>
  );
}
```

## ğŸ“‹ API Methods

### UserAPI Class

#### Profile Operations
- `getMyProfile()` - Get current user profile
- `updateMyProfile(data)` - Update current user profile
- `getUser(userId)` - Get specific user (admin only)
- `createUser(data)` - Create new user (admin only)
- `updateUser(userId, data)` - Update user (admin only)
- `deleteUser(userId)` - Delete user (admin only)

#### Task Operations
- `getUserTasks(userId, params?)` - Get user's tasks
- `addUserTask(userId, taskData)` - Add task to user
- `updateUserTask(userId, taskId, taskData)` - Update user task
- `deleteUserTask(userId, taskId)` - Delete user task

#### Metric Operations
- `getUserMetrics(userId, params?)` - Get user's metrics
- `addUserMetric(userId, metricData)` - Add metric to user

#### Level Operations
- `getUserLevels(userId)` - Get user's level progress

### useCurrentUserAPI Hook

Provides convenience methods for the current authenticated user:

```typescript
const {
  getMyProfile,
  updateMyProfile,
  getMyTasks,
  addTaskToMe,
  updateMyTask,
  deleteMyTask,
  getMyMetrics,
  addMetricToMe,
  getMyLevels,
  userId
} = useCurrentUserAPI();
```

### useAdminUserAPI Hook

Provides admin-level operations:

```typescript
const {
  getUsers,
  getUser,
  createUser,
  updateUser,
  deleteUser,
  getUserTasks,
  getUserMetrics,
  getUserLevels
} = useAdminUserAPI();
```

## ğŸ”§ Parameters and Types

### Task Parameters
```typescript
interface TaskParams {
  category?: 'Fitness' | 'Productivity' | 'Nutrition' | 'Finance' | 'Social' | 'Knowledge';
  completed?: boolean;
  page?: number;
  limit?: number;
}

interface TaskData {
  title: string;
  category: 'Fitness' | 'Productivity' | 'Nutrition' | 'Finance' | 'Social' | 'Knowledge';
  dueDate?: string;
  completed?: boolean;
  xpValue?: number;
  autoGenerated?: boolean;
}
```

### Metric Parameters
```typescript
interface MetricParams {
  metricType?: 'workout' | 'meal' | 'finance' | 'study' | 'sleep';
  startDate?: string;
  endDate?: string;
  page?: number;
  limit?: number;
}

interface MetricData {
  metricType: 'workout' | 'meal' | 'finance' | 'study' | 'sleep';
  value: number;
  unit?: string;
  date?: string;
  notes?: string;
}
```

### User Parameters
```typescript
interface UserParams {
  page?: number;
  limit?: number;
  sortBy?: 'createdAt' | 'updatedAt' | 'name' | 'email';
  sortOrder?: 'asc' | 'desc';
}
```

## ğŸ“Š Response Types

All API methods return typed responses:

```typescript
// Single item response
ApiResponse<User>

// Paginated response
PaginatedResponse<BaseTask>

// Direct data response
User | BaseTask | Metric | Record<string, LevelProgress>
```

## ğŸ›¡ï¸ Error Handling

All API methods include comprehensive error handling:

```typescript
try {
  const user = await UserAPI.getMyProfile();
  console.log('User:', user);
} catch (error) {
  console.error('API Error:', error.message);
  // Handle error appropriately
}
```

## ğŸ” Authentication

The API automatically handles authentication through the main API client:

- JWT tokens are automatically included in requests
- Token expiration is handled with automatic logout
- Unauthorized requests redirect to login page

## ğŸ“± Example Component

See `src/components/user/UserProfile.tsx` for a complete example of how to use the User API in a React component.

## ğŸš€ Advanced Usage

### Parallel Data Loading

```typescript
const loadUserData = async () => {
  const [user, tasks, metrics, levels] = await Promise.all([
    userAPI.getMyProfile(),
    userAPI.getMyTasks({ limit: 5 }),
    userAPI.getMyMetrics({ limit: 5 }),
    userAPI.getMyLevels(),
  ]);
  
  // Process data...
};
```

### Real-time Updates

```typescript
const handleTaskComplete = async (taskId: string) => {
  try {
    await userAPI.updateMyTask(taskId, { completed: true });
    // Refresh tasks list
    const updatedTasks = await userAPI.getMyTasks();
    setTasks(updatedTasks.data);
  } catch (error) {
    console.error('Failed to complete task:', error);
  }
};
```

## ğŸ”„ Integration with Backend

This API is designed to work seamlessly with the backend routes defined in `backend/src/routes/users.ts`:

- All endpoints match the backend route structure
- Request/response formats are consistent
- Validation errors are properly handled
- Pagination and filtering are supported

## ğŸ“ Notes

- All methods are async and return Promises
- Error messages are user-friendly and localized
- TypeScript provides full type safety
- The API is designed to be easily testable
- Caching can be implemented at the component level as needed
